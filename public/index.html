<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Speech-to-Text Translator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf"></script>
</head>
<body class="bg-gradient-to-br from-blue-200 to-purple-300 min-h-screen flex items-center justify-center">
  <div class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-2xl text-center relative overflow-hidden">
    <div class="absolute top-0 left-0 w-20 h-20 bg-purple-500 rounded-br-full"></div>
    <div class="absolute bottom-0 right-0 w-20 h-20 bg-blue-500 rounded-tl-full"></div>
    
    <h1 class="text-3xl font-bold text-gray-800 mb-6">Speech-to-Text Translator</h1>
    
    <div class="flex justify-center space-x-4 mb-6">
      <button id="startButton" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-full shadow-md">Start Listening</button>
      <button id="stopButton" disabled class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-6 rounded-full shadow-md opacity-50">Stop Listening</button>
    </div>
    
    <div id="output" class="bg-gray-100 p-4 rounded-lg shadow-inner h-40 overflow-auto text-left text-gray-700 border-l-4 border-blue-500"></div>
    
    <button id="downloadButton" class="mt-6 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-full shadow-md hidden">Download as PDF</button>
  </div>

  <script>
    let recognition;
    let finalText = '';
    const output = document.getElementById('output');
    const startButton = document.getElementById('startButton');
    const stopButton = document.getElementById('stopButton');
    const downloadButton = document.getElementById('downloadButton');

    function initSpeechRecognition() {
      recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
      recognition.lang = 'auto';
      recognition.continuous = true;

      recognition.onresult = async (event) => {
        const speechText = event.results[event.results.length - 1][0].transcript;
        output.innerHTML += `<p class='text-gray-800 font-semibold'>Detected: <span class='text-blue-500'>${speechText}</span></p>`;

        const response = await fetch('/api/translate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ text: speechText })
        });
        const data = await response.json();
        output.innerHTML += `<p class='text-gray-800 font-semibold'>Translated: <span class='text-purple-500'>${data.translatedText}</span></p>`;
        finalText += `\n${data.translatedText}`;
        downloadButton.style.display = 'block';
      };

      recognition.onerror = (event) => {
        console.error("Recognition error:", event.error);
      };
    }

    startButton.onclick = () => {
      startButton.disabled = true;
      stopButton.disabled = false;
      stopButton.classList.remove('opacity-50');
      initSpeechRecognition();
      recognition.start();
    };

    stopButton.onclick = () => {
      startButton.disabled = false;
      stopButton.disabled = true;
      stopButton.classList.add('opacity-50');
      recognition.stop();
    };

    downloadButton.onclick = () => {
      const doc = new jsPDF();
      doc.text(finalText, 10, 10);
      doc.save('transcription.pdf');
    };
  </script>
</body>
</html>
